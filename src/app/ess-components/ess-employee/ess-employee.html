<div class="employee-page-container">
  <div class="employee-list-container">
    <div class="employee-card">
      <!-- Header Section -->
      <div class="employee-header">
        <div class="header-left">
          <h1 class="page-title">Employees</h1>
          <p-breadcrumb [model]="breadcrumbItems()" class="breadcrumb-custom"></p-breadcrumb>
        </div>
        <div class="header-right">
          <p-button (click)="onAdd()" label="Add New Employee" icon="pi pi-plus" styleClass="add-employee-btn"
            [raised]="true">
          </p-button>
        </div>
      </div>

      <!-- Table Section -->
      <div class="table-container">
        <p-table [value]="employees()" [paginator]="true" [rows]="pageSize()" [totalRecords]="totalRecords()"
          [first]="(currentPage() - 1) * pageSize()" [loading]="loading()" [lazy]="true"
          (onLazyLoad)="onPageChange($event)" [sortMode]="'single'" [sortField]="sortBy()"
          [sortOrder]="sortOrder() === 'asc' ? 1 : -1" responsiveLayout="scroll" [tableStyle]="{'min-width': '50rem'}">
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
              <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
              <th>Phone</th>
              <th>Department</th>
              <th>Status</th>
              <th pSortableColumn="joiningDate">Joining Date <p-sortIcon field="joiningDate"></p-sortIcon></th>
              <th class="table-action-header">Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-e>
            <tr>
              <td>{{ e.name }}</td>
              <td>{{ e.email }}</td>
              <td>{{ e.phone }}</td>
              <td>{{ e.department }}</td>
              <td>
                <span class="status-badge" [ngClass]="e.status === 'Active' ? 'status-active' : 'status-inactive'">
                  {{ e.status }}
                </span>
              </td>
              <td>{{ e.joiningDate }}</td>
              <td class="table-action-cell">
                <button type="button" #actionButton class="action-button"
                  (click)="actionPanel.toggle($event, actionButton)">
                  <i class="pi pi-ellipsis-v action-icon"></i>
                </button>
                <p-popover #actionPanel>
                  <div class="action-menu">
                    <button (click)="onView(e); actionPanel.hide()" title="View" class="action-menu-item">
                      <i class="pi pi-eye action-menu-icon"></i> View
                    </button>
                    <button (click)="onEdit(e); actionPanel.hide()" title="Edit" class="action-menu-item">
                      <i class="pi pi-pencil action-menu-icon"></i> Edit
                    </button>
                    <button (click)="onDelete(e); actionPanel.hide()" title="Delete" class="action-menu-item action-menu-item-delete">
                      <i class="pi pi-trash action-menu-icon"></i> Delete
                    </button>
                  </div>
                </p-popover>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>

  <p-drawer [visible]="drawerVisible()" [position]="'right'" [modal]="true"
    [style]="{ width: '60%', 'max-width': '100%', 'overflow-y': 'auto' }" (onHide)="onDrawerClose()">
    <ng-template pTemplate="header">
      <div class="drawer-header">
        <span class="drawer-title">{{ drawerMode() === 'add' ? 'Add Employee' : drawerMode() === 'edit' ?
          'Edit Employee' : 'View Employee' }}</span>
        <i class="pi pi-user drawer-icon"></i>
      </div>
    </ng-template>
    <ng-template pTemplate="content">
      <form [formGroup]="employeeForm" (ngSubmit)="onFormSubmit()" class="employee-form">
        <div class="form-section">
          <div class="form-section-header">
            <h4 class="form-section-title">
              <i class="pi pi-info-circle form-section-icon"></i> Employee Details
            </h4>
          </div>
          <div class="form-grid">
            <div class="form-field">
              <label class="form-label">Name<span class="required-asterisk">*</span></label>
              <input pInputText formControlName="name" class="form-input"
                [class.p-invalid]="drawerMode() !== 'view' && employeeForm.get('name')?.invalid && employeeForm.get('name')?.touched"
                placeholder="Enter Employee Name" />
              @if (drawerMode() !== 'view' && employeeForm.get('name')?.invalid && employeeForm.get('name')?.touched) {
              <small class="form-error">Name is required.</small>
              }
            </div>

            <div class="form-field">
              <label class="form-label">Email<span class="required-asterisk">*</span></label>
              <input pInputText formControlName="email" class="form-input"
                [class.p-invalid]="drawerMode() !== 'view' && employeeForm.get('email')?.invalid && employeeForm.get('email')?.touched"
                placeholder="Enter Email" />
              @if (drawerMode() !== 'view' && employeeForm.get('email')?.invalid && employeeForm.get('email')?.touched)
              {
              <small class="form-error">Email is required or invalid format.</small>
              }
            </div>

            <div class="form-field">
              <label class="form-label">Phone</label>
              <input pInputText formControlName="phone" class="form-input" placeholder="Enter Phone Number" />
            </div>

            <div class="form-field">
              <label class="form-label">Department<span class="required-asterisk">*</span></label>
              <p-select [options]="departments" optionLabel="label" optionValue="value" formControlName="department"
                placeholder="Select Department" [filter]="true" [showClear]="true" class="form-select"
                [class.p-invalid]="drawerMode() !== 'view' && employeeForm.get('department')?.invalid && employeeForm.get('department')?.touched"></p-select>
              @if (drawerMode() !== 'view' && employeeForm.get('department')?.invalid &&
              employeeForm.get('department')?.touched) {
              <small class="form-error">Department is required.</small>
              }
            </div>

            <div class="form-field">
              <label class="form-label">Status<span class="required-asterisk">*</span></label>
              <p-select [options]="statuses" optionLabel="label" optionValue="value" formControlName="status"
                placeholder="Select Status" [filter]="true" class="form-select"></p-select>
            </div>

            <div class="form-field">
              <label class="form-label">Joining Date<span class="required-asterisk">*</span></label>
              <input pInputText type="date" formControlName="joiningDate" class="form-input"
                [class.p-invalid]="drawerMode() !== 'view' && employeeForm.get('joiningDate')?.invalid && employeeForm.get('joiningDate')?.touched" />
              @if (drawerMode() !== 'view' && employeeForm.get('joiningDate')?.invalid &&
              employeeForm.get('joiningDate')?.touched) {
              <small class="form-error">Joining Date is required.</small>
              }
            </div>
          </div>
        </div>

        <div class="form-actions">
          @if (drawerMode() === 'add') {
          <p-button label="Reset" severity="secondary" icon="pi pi-refresh" type="button"
            (click)="employeeForm.reset()"></p-button>
          }
          @if (drawerMode() !== 'view') {
          <p-button [label]="drawerMode() === 'edit' ? 'Update' : 'Submit'" icon="pi pi-check" type="submit"
            severity="success" [loading]="formLoading()"></p-button>
          }
          <p-button label="Close" severity="secondary" icon="pi pi-times" type="button"
            (click)="onDrawerClose()"></p-button>
        </div>
      </form>
    </ng-template>
  </p-drawer>

  <p-confirmDialog></p-confirmDialog>
  <p-toast></p-toast>
</div>